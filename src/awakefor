#!/bin/bash
#
# This script was generated by ChatGPT.
# awakefor - Show how long the system has been awake since last resume
#

# Find the most recent "PM: suspend exit" event (resume from suspend)
last_resume=$(journalctl --dmesg --grep="PM: suspend exit" -n1 --output=short-unix | awk '{print $1}' | cut -d. -f1)

# If nothing found, bail gracefully
if [ -z "$last_resume" ]; then
    echo "Could not detect last resume time (no suspend events found)."
    exit 1
fi

# Current epoch time
now=$(date +%s)

# Sanity check: both must be integers
if ! [[ "$last_resume" =~ ^[0-9]+$ ]] || ! [[ "$now" =~ ^[0-9]+$ ]]; then
    if [[ "$last_resume" =~ "--" ]]; then
        echo "Info: system never entered suspend (last_resume='$last_resume', now='$now')"
        exit 0
    else
        echo "Error: unexpected timestamp format (last_resume='$last_resume', now='$now')"
        exit 1
    fi
fi

# Difference in seconds
diff=$(( now - last_resume ))

# If negative (weird clock drift), fix it
if [ "$diff" -lt 0 ]; then
    diff=0
fi

# Convert seconds into d h m s
days=$(( diff/86400 ))
hours=$(( (diff%86400)/3600 ))
mins=$(( (diff%3600)/60 ))
secs=$(( diff%60 ))

# Pretty print like uptime -p
out="up"
[ $days -gt 0 ] && out="$out $days day(s)"
[ $hours -gt 0 ] && out="$out $hours hour(s)"
[ $mins -gt 0 ] && out="$out $mins minute(s)"
[ $secs -gt 0 ] && out="$out $secs second(s)"

echo "$out since last resume"

